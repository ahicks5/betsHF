{% extends "base.html" %}

{% block title %}Play History - NBA Props Analyzer{% endblock %}

{% block content %}
<h2>Play History</h2>

<div class="filters">
    <form method="get">
        <div>
            <label>Show last:</label>
            <select name="days" onchange="this.form.submit()">
                <option value="7" {% if days == 7 %}selected{% endif %}>7 days</option>
                <option value="14" {% if days == 14 %}selected{% endif %}>14 days</option>
                <option value="30" {% if days == 30 %}selected{% endif %}>30 days</option>
                <option value="90" {% if days == 90 %}selected{% endif %}>90 days</option>
            </select>
        </div>
        <button type="submit">Update</button>
    </form>
</div>

{% if plays_by_date %}
    {% for date, plays in plays_by_date.items()|sort(reverse=True) %}
    <div class="card">
        <h3>{{ date.strftime('%B %d, %Y') }} - {{ plays|length }} plays</h3>

        <table>
            <thead>
                <tr>
                    <th>Player</th>
                    <th>Stat</th>
                    <th>Vegas Line</th>
                    <th>Play</th>
                    <th>Odds</th>
                    <th>Strength</th>
                    <th>Actual Result</th>
                    <th>Outcome</th>
                    <th>Profit/Loss</th>
                </tr>
            </thead>
            <tbody>
                {% for play in plays %}
                <tr>
                    <td><a href="/plays/{{ play.id }}" class="play-link">{{ play.player_name }}</a></td>
                    <td>{{ play.stat_type }}</td>
                    <td><strong>{{ play.line_value|format_float }}</strong></td>
                    <td>
                        {% if play.recommendation == 'OVER' %}
                            <span class="badge badge-over">OVER</span>
                        {% elif play.recommendation == 'UNDER' %}
                            <span class="badge badge-under">UNDER</span>
                        {% else %}
                            <span class="badge badge-no-play">NO PLAY</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if play.recommendation == 'OVER' %}
                            {{ play.over_odds|format_odds }}
                        {% elif play.recommendation == 'UNDER' %}
                            {{ play.under_odds|format_odds }}
                        {% else %}
                            -
                        {% endif %}
                    </td>
                    <td>{{ play.z_score|z_to_confidence }}</td>
                    <td>
                        {% if play.actual_result is not none %}
                            <strong>{{ play.actual_result|format_float }}</strong>
                        {% else %}
                            <span style="color: #95a5a6;">Pending</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if play.recommendation == 'NO PLAY' %}
                            {% if play.actual_result is not none %}
                                <span class="badge" style="background: #95a5a6; color: white;">SKIP</span>
                            {% else %}
                                <span style="color: #95a5a6;">-</span>
                            {% endif %}
                        {% elif play.was_correct == true %}
                            <span class="badge" style="background: #27ae60; color: white;">✓ WIN</span>
                        {% elif play.was_correct == false %}
                            <span class="badge" style="background: #e74c3c; color: white;">✗ LOSS</span>
                        {% else %}
                            <span style="color: #95a5a6;">-</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if play.recommendation != 'NO PLAY' and play.was_correct is not none %}
                            {{ play|calculate_profit(10)|safe }}
                        {% else %}
                            <span style="color: #95a5a6;">-</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endfor %}
{% else %}
<div class="empty-state">
    <h2>No historical plays found</h2>
    <p>Start running the daily analysis to build up historical data.</p>
</div>
{% endif %}
{% endblock %}
