{% extends "base.html" %}

{% block title %}Analytics Dashboard - Take Free Points{% endblock %}

{% block content %}
<!-- Page Header with Model Branding -->
<div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1.5rem; flex-wrap: wrap;">
    <h2 style="margin: 0;">Analytics Dashboard</h2>
    <div style="display: flex; align-items: center; gap: 0.5rem; padding: 0.4rem 0.9rem; background: rgba(0, 255, 136, 0.08); border: 1px solid rgba(0, 255, 136, 0.2); border-radius: 6px;">
        <span style="width: 6px; height: 6px; background: var(--accent-green); border-radius: 50%; box-shadow: 0 0 8px var(--accent-green);"></span>
        <span style="font-family: 'JetBrains Mono', monospace; font-size: 0.85rem; font-weight: 600; color: var(--accent-green);">Pulsar 1.0</span>
    </div>
</div>

<!-- KEY METRICS -->
<div class="stat-grid">
    <div class="stat-box">
        <h3>{{ total_plays }}</h3>
        <p>Total Plays</p>
        <small>{{ high_confidence }} High / {{ medium_confidence }} Medium</small>
    </div>
    <div class="stat-box">
        <h3>{{ total_graded }}</h3>
        <p>Graded Plays</p>
        <small>{{ wins }}W - {{ losses }}L</small>
    </div>
    <div class="stat-box">
        <h3>{{ win_rate|format_float(1) }}%</h3>
        <p>Win Rate</p>
        <small>{% if win_rate >= 55 %}üî• Excellent{% elif win_rate >= 50 %}‚úÖ Profitable{% else %}‚ö†Ô∏è Below 50%{% endif %}</small>
    </div>
    <div class="stat-box" style="{% if total_profit > 0 %}border-top: 3px solid var(--success);{% else %}border-top: 3px solid var(--danger);{% endif %}">
        <h3>${{ total_profit|format_float(2) }}</h3>
        <p>Total Profit</p>
        <small>{% if total_profit > 0 %}+{% endif %}{{ roi|format_float(1) }}% ROI</small>
    </div>
</div>

{% if total_graded > 0 %}

<!-- ODDS ANALYSIS -->
<h2 style="margin-top: 2.5rem; margin-bottom: 1rem;">Odds Analysis</h2>
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
    <div class="card">
        <h3 style="color: var(--success);">Winning Bets</h3>
        <div style="text-align: center; padding: 1.5rem 0;">
            <h2 style="color: var(--success); margin: 0;">{% if avg_winning_odds > 0 %}+{% endif %}{{ avg_winning_odds|round(1) }}</h2>
            <p style="margin-top: 0.5rem; color: var(--text-dim);">Average Odds</p>
        </div>
    </div>
    <div class="card">
        <h3 style="color: var(--danger);">Losing Bets</h3>
        <div style="text-align: center; padding: 1.5rem 0;">
            <h2 style="color: var(--danger); margin: 0;">{% if avg_losing_odds > 0 %}+{% endif %}{{ avg_losing_odds|round(1) }}</h2>
            <p style="margin-top: 0.5rem; color: var(--text-dim);">Average Odds</p>
        </div>
    </div>
</div>

<!-- OVER VS UNDER PERFORMANCE -->
<h2 style="margin-top: 2.5rem; margin-bottom: 1rem;">Over vs Under Performance</h2>
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem;">
    <div class="card" style="border-left: 4px solid var(--success);">
        <h3>OVER Bets</h3>
        <div style="margin-top: 1rem;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span>Win Rate:</span>
                <strong style="color: {% if over_win_rate >= 50 %}var(--success){% else %}var(--danger){% endif %};">{{ over_win_rate|format_float(1) }}%</strong>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span>Record:</span>
                <strong>{{ (over_total * over_win_rate / 100)|int }}-{{ over_total - (over_total * over_win_rate / 100)|int }}</strong>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <span>Profit:</span>
                <strong style="color: {% if over_profit > 0 %}var(--success){% else %}var(--danger){% endif %};">${{ over_profit|format_float(2) }}</strong>
            </div>
        </div>
    </div>

    <div class="card" style="border-left: 4px solid var(--accent-blue);">
        <h3>UNDER Bets</h3>
        <div style="margin-top: 1rem;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span>Win Rate:</span>
                <strong style="color: {% if under_win_rate >= 50 %}var(--success){% else %}var(--danger){% endif %};">{{ under_win_rate|format_float(1) }}%</strong>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                <span>Record:</span>
                <strong>{{ (under_total * under_win_rate / 100)|int }}-{{ under_total - (under_total * under_win_rate / 100)|int }}</strong>
            </div>
            <div style="display: flex; justify-content: space-between;">
                <span>Profit:</span>
                <strong style="color: {% if under_profit > 0 %}var(--success){% else %}var(--danger){% endif %};">${{ under_profit|format_float(2) }}</strong>
            </div>
        </div>
    </div>
</div>

<!-- PERFORMANCE BREAKDOWNS -->
<h2 style="margin-top: 2.5rem; margin-bottom: 1rem;">Performance Breakdowns</h2>
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 1.5rem;">
    <div class="card">
        <h3>By Confidence Level</h3>
        <table style="margin-top: 1rem;">
            <thead>
                <tr>
                    <th>Level</th>
                    <th>Record</th>
                    <th>Win Rate</th>
                    <th>Profit</th>
                    <th>ROI</th>
                </tr>
            </thead>
            <tbody>
                {% for conf in ['High', 'Medium'] %}
                <tr>
                    <td><strong>{{ conf }}</strong></td>
                    <td>{{ win_rate_by_conf[conf].wins }}-{{ win_rate_by_conf[conf].total - win_rate_by_conf[conf].wins }}</td>
                    <td><strong style="color: {% if win_rate_by_conf[conf].rate >= 50 %}var(--success){% else %}var(--danger){% endif %};">{{ win_rate_by_conf[conf].rate|format_float(1) }}%</strong></td>
                    <td style="color: {% if profit_by_conf[conf] > 0 %}var(--success){% else %}var(--danger){% endif %};">
                        ${{ profit_by_conf[conf]|format_float(2) }}
                    </td>
                    <td>{{ ((profit_by_conf[conf] / (win_rate_by_conf[conf].total * bet_amount)) * 100)|format_float(1) if win_rate_by_conf[conf].total > 0 else 0 }}%</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="card">
        <h3>By Stat Type</h3>
        <table style="margin-top: 1rem;">
            <thead>
                <tr>
                    <th>Stat</th>
                    <th>Record</th>
                    <th>Win Rate</th>
                    <th>Profit</th>
                </tr>
            </thead>
            <tbody>
                {% for stat, data in win_rate_by_stat.items()|sort(attribute='1.rate', reverse=True) %}
                <tr>
                    <td><strong>{{ stat }}</strong></td>
                    <td>{{ data.wins }}-{{ data.total - data.wins }}</td>
                    <td><strong style="color: {% if data.rate >= 50 %}var(--success){% else %}var(--danger){% endif %};">{{ data.rate|format_float(1) }}%</strong></td>
                    <td style="color: {% if profit_by_stat[stat] > 0 %}var(--success){% else %}var(--danger){% endif %};">
                        ${{ profit_by_stat[stat]|format_float(2) }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- Z-SCORE EFFECTIVENESS -->
<h2 style="margin-top: 2.5rem; margin-bottom: 1rem;">Signal Strength Performance</h2>
<div class="card">
    <h3>Profitability by Z-Score Range</h3>
    <p style="margin-top: 0.5rem; color: var(--text-dim);">Does higher confidence signal translate to better profits?</p>
    <table style="margin-top: 1.5rem;">
        <thead>
            <tr>
                <th>Signal Strength</th>
                <th>Plays</th>
                <th>Record</th>
                <th>Win %</th>
                <th>Profit</th>
                <th>ROI</th>
                <th>Performance</th>
            </tr>
        </thead>
        <tbody>
            {% for range in ['1.5+', '1.0-1.5', '0.75-1.0', '0.5-0.75'] %}
            {% set range_profit = profit_by_z_score_range.get(range, 0) if profit_by_z_score_range else 0 %}
            {% set range_roi = ((range_profit / (z_score_performance[range].total * bet_amount)) * 100) if z_score_performance[range].total > 0 else 0 %}
            <tr>
                <td>
                    <strong>{{ range }}œÉ</strong>
                    {% if range == '1.5+' %}
                        <br><small style="color: var(--text-dim);">Strongest</small>
                    {% elif range == '0.5-0.75' %}
                        <br><small style="color: var(--text-dim);">Weakest</small>
                    {% endif %}
                </td>
                <td>{{ z_score_performance[range].total }}</td>
                <td>{{ z_score_performance[range].wins }}-{{ z_score_performance[range].total - z_score_performance[range].wins }}</td>
                <td><strong>{{ z_score_performance[range].win_rate|format_float(1) }}%</strong></td>
                <td style="font-weight: 700; font-family: 'JetBrains Mono', monospace; {% if range_profit > 0 %}color: var(--success);{% elif range_profit < 0 %}color: var(--danger);{% endif %}">
                    {% if range_profit > 0 %}+{% endif %}${{ range_profit|format_float(2) }}
                </td>
                <td style="{% if range_roi > 0 %}color: var(--success);{% elif range_roi < 0 %}color: var(--danger);{% endif %}">
                    {{ range_roi|format_float(1) }}%
                </td>
                <td>
                    {% if range_profit > 20 %}
                        <span class="badge" style="background: linear-gradient(135deg, var(--success), #059669); color: white;">üí∞ Profitable</span>
                    {% elif range_profit > 0 %}
                        <span class="badge" style="background: var(--success); color: white;">‚úì Positive</span>
                    {% elif range_profit == 0 %}
                        <span class="badge" style="background: var(--text-dim); color: white;">‚Üí Break Even</span>
                    {% else %}
                        <span class="badge" style="background: var(--text-secondary); color: white;">‚Üì Negative</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    <p style="margin-top: 1rem; font-size: 0.9rem; color: var(--text-dim);">
        <strong>Note:</strong> Profitability matters more than win rate. A 48% win rate with favorable odds can be more profitable than a 52% win rate with poor odds.
    </p>
</div>

<!-- TOP & WORST PLAYERS -->
<h2 style="margin-top: 2.5rem; margin-bottom: 1rem;">Player Performance</h2>
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 1.5rem;">
    <div class="card" style="border-top: 3px solid var(--success);">
        <h3>üèÜ Top 10 Most Profitable Players</h3>
        <table style="margin-top: 1rem;">
            <thead>
                <tr>
                    <th>Player</th>
                    <th>Record</th>
                    <th>Win %</th>
                    <th>Profit</th>
                </tr>
            </thead>
            <tbody>
                {% for player_name, stats in top_players %}
                <tr>
                    <td><strong>{{ player_name[:20] }}</strong></td>
                    <td>{{ stats.wins }}-{{ stats.total - stats.wins }}</td>
                    <td>{{ stats.win_rate|format_float(1) }}%</td>
                    <td style="color: var(--success); font-weight: bold;">${{ stats.profit|format_float(2) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="card" style="border-top: 3px solid var(--danger);">
        <h3>üí∏ Worst 10 Players (By Profit)</h3>
        <table style="margin-top: 1rem;">
            <thead>
                <tr>
                    <th>Player</th>
                    <th>Record</th>
                    <th>Win %</th>
                    <th>Loss</th>
                </tr>
            </thead>
            <tbody>
                {% for player_name, stats in worst_players %}
                <tr>
                    <td><strong>{{ player_name[:20] }}</strong></td>
                    <td>{{ stats.wins }}-{{ stats.total - stats.wins }}</td>
                    <td>{{ stats.win_rate|format_float(1) }}%</td>
                    <td style="color: var(--danger); font-weight: bold;">${{ stats.profit|format_float(2) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<!-- BOOKMAKER ANALYSIS -->
<h2 style="margin-top: 2.5rem; margin-bottom: 1rem;">Bookmaker Analysis</h2>
<div class="card">
    <h3>Performance by Sportsbook</h3>
    <p style="margin-top: 0.5rem; color: var(--text-dim);">Which bookmakers provide the best value?</p>
    <table style="margin-top: 1.5rem;">
        <thead>
            <tr>
                <th>Bookmaker</th>
                <th>Plays</th>
                <th>Record</th>
                <th>Win Rate</th>
                <th>Profit</th>
                <th>ROI</th>
            </tr>
        </thead>
        <tbody>
            {% for bookie, stats in bookmaker_stats.items()|sort(attribute='1.profit', reverse=True) %}
            <tr>
                <td><strong>{{ bookie }}</strong></td>
                <td>{{ stats.total }}</td>
                <td>{{ stats.wins }}-{{ stats.total - stats.wins }}</td>
                <td><strong style="color: {% if stats.win_rate >= 50 %}var(--success){% else %}var(--danger){% endif %};">{{ stats.win_rate|format_float(1) }}%</strong></td>
                <td style="color: {% if stats.profit > 0 %}var(--success){% else %}var(--danger){% endif %}; font-weight: bold;">${{ stats.profit|format_float(2) }}</td>
                <td>{{ ((stats.profit / (stats.total * bet_amount)) * 100)|format_float(1) }}%</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<!-- PROFIT OVER TIME -->
<h2 style="margin-top: 2.5rem; margin-bottom: 1rem;">Profit Over Time</h2>
<div class="card">
    <h3>Cumulative Profit Trend</h3>
    <p style="margin-top: 0.5rem; color: var(--text-dim);">Track how your bankroll has grown (or shrunk) over time</p>

    <!-- Chart -->
    <div style="margin-top: 1.5rem; height: 300px; position: relative;">
        <canvas id="profitChart"></canvas>
    </div>

    <!-- Data Table (collapsed by default) -->
    <details style="margin-top: 2rem;">
        <summary style="cursor: pointer; font-weight: bold; padding: 0.5rem; background: var(--bg-secondary); border-radius: 4px;">
            üìä View Data Table
        </summary>
        <div style="margin-top: 1rem; overflow-x: auto;">
            <table style="font-size: 0.85rem;">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>Cumulative Profit</th>
                        <th>Trend</th>
                    </tr>
                </thead>
                <tbody>
                    {% for i in range([cumulative_profit_data|length, 15]|min) %}
                    {% set idx = cumulative_profit_data|length - 1 - i %}
                    {% set data = cumulative_profit_data[idx] %}
                    {% set prev_profit = cumulative_profit_data[idx - 1].profit if idx > 0 else 0 %}
                    <tr>
                        <td>{{ data.date }}</td>
                        <td style="color: {% if data.profit > 0 %}var(--success){% else %}var(--danger){% endif %}; font-weight: bold; font-family: 'JetBrains Mono', monospace;">
                            ${{ data.profit }}
                        </td>
                        <td>
                            {% if data.profit > prev_profit %}
                                <span style="color: var(--success);">‚Üó Up</span>
                            {% elif data.profit < prev_profit %}
                                <span style="color: var(--danger);">‚Üò Down</span>
                            {% else %}
                                <span style="color: var(--text-dim);">‚Üí Flat</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </details>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script>
// Profit Over Time Chart
const profitData = {{ cumulative_profit_data|tojson }};
const dates = profitData.map(d => d.date);
const profits = profitData.map(d => d.profit);

const ctx = document.getElementById('profitChart').getContext('2d');
new Chart(ctx, {
    type: 'line',
    data: {
        labels: dates,
        datasets: [{
            label: 'Cumulative Profit ($)',
            data: profits,
            borderColor: profits[profits.length - 1] >= 0 ? '#27ae60' : '#e74c3c',
            backgroundColor: profits[profits.length - 1] >= 0 ? 'rgba(39, 174, 96, 0.1)' : 'rgba(231, 76, 60, 0.1)',
            borderWidth: 2,
            tension: 0.3,
            fill: true,
            pointRadius: 3,
            pointHoverRadius: 6,
            pointBackgroundColor: profits[profits.length - 1] >= 0 ? '#27ae60' : '#e74c3c',
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                display: true,
                labels: {
                    color: '#e0e0e0',
                    font: {
                        size: 12
                    }
                }
            },
            tooltip: {
                backgroundColor: 'rgba(30, 30, 30, 0.95)',
                titleColor: '#e0e0e0',
                bodyColor: '#e0e0e0',
                borderColor: '#444',
                borderWidth: 1,
                callbacks: {
                    label: function(context) {
                        let value = context.parsed.y;
                        return 'Profit: $' + value.toFixed(2);
                    }
                }
            }
        },
        scales: {
            x: {
                ticks: {
                    color: '#999',
                    maxRotation: 45,
                    minRotation: 45,
                    autoSkip: true,
                    maxTicksLimit: 20
                },
                grid: {
                    color: 'rgba(255, 255, 255, 0.05)'
                }
            },
            y: {
                ticks: {
                    color: '#999',
                    callback: function(value) {
                        return '$' + value.toFixed(0);
                    }
                },
                grid: {
                    color: 'rgba(255, 255, 255, 0.05)'
                }
            }
        }
    }
});
</script>

<!-- DAILY PROFIT -->
<h2 style="margin-top: 2.5rem; margin-bottom: 1rem;">Recent Daily Performance</h2>
<div class="card">
    <h3>Last 30 Days - Profit/Loss by Date</h3>
    <table style="margin-top: 1.5rem;">
        <thead>
            <tr>
                <th>Date</th>
                <th>Daily P/L</th>
                <th>Performance</th>
            </tr>
        </thead>
        <tbody>
            {% for date, profit in daily_profit[:15] %}
            <tr>
                <td>{{ date }}</td>
                <td style="color: {% if profit > 0 %}var(--success){% else %}var(--danger){% endif %}; font-weight: bold; font-family: 'JetBrains Mono', monospace;">
                    {% if profit > 0 %}+{% endif %}${{ profit|format_float(2) }}
                </td>
                <td>
                    {% if profit > 10 %}
                        <span class="badge badge-high">üî• Great Day</span>
                    {% elif profit > 0 %}
                        <span class="badge badge-over">Profitable</span>
                    {% elif profit == 0 %}
                        <span class="badge badge-no-play">Break Even</span>
                    {% else %}
                        <span class="badge" style="background: var(--danger);">Loss</span>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

{% else %}
<div class="card" style="margin-top: 2rem;">
    <h3>No Results Yet</h3>
    <p>Once games are completed and results are collected, comprehensive analytics will appear here.</p>
    <p style="margin-top: 1rem;"><strong>To collect results:</strong> Run <code>python scripts/collect_results.py</code></p>
</div>
{% endif %}

<!-- RISK METRICS (Hedge Fund Style) -->
<h2 style="margin-top: 2.5rem; margin-bottom: 1rem;">Risk & Performance Metrics</h2>
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
    <div class="stat-box" style="border-left: 3px solid var(--accent-purple);">
        <p style="color: var(--text-dim); font-size: 0.75rem;">CURRENT STREAK</p>
        <h3 style="font-size: 2rem; margin: 0.5rem 0;">
            {% if current_streak > 0 %}
                {{ current_streak }}W
            {% elif current_streak < 0 %}
                {{ current_streak|abs }}L
            {% else %}
                -
            {% endif %}
        </h3>
        <small style="color: {% if current_streak > 0 %}var(--success){% elif current_streak < 0 %}var(--danger){% else %}var(--text-dim){% endif %};">
            {% if current_streak > 0 %}üî• On Fire{% elif current_streak < 0 %}üìâ Cold Streak{% else %}Fresh Start{% endif %}
        </small>
    </div>

    <div class="stat-box" style="border-left: 3px solid var(--success);">
        <p style="color: var(--text-dim); font-size: 0.75rem;">LONGEST WIN STREAK</p>
        <h3 style="font-size: 2rem; margin: 0.5rem 0; color: var(--success);">{{ longest_win_streak }}</h3>
        <small style="color: var(--text-dim);">consecutive wins</small>
    </div>

    <div class="stat-box" style="border-left: 3px solid var(--danger);">
        <p style="color: var(--text-dim); font-size: 0.75rem;">MAX DRAWDOWN</p>
        <h3 style="font-size: 2rem; margin: 0.5rem 0; color: var(--danger);">
            {% if max_drawdown %}
                ${{ max_drawdown|format_float(2) }}
            {% else %}
                $0.00
            {% endif %}
        </h3>
        <small style="color: var(--text-dim);">biggest bankroll dip</small>
    </div>

    <div class="stat-box" style="border-left: 3px solid var(--warning);">
        <p style="color: var(--text-dim); font-size: 0.75rem;">AVG WIN vs AVG LOSS</p>
        <h3 style="font-size: 1.5rem; margin: 0.5rem 0;">
            <span style="color: var(--success);">${{ avg_win_amount|format_float(2) }}</span>
            <span style="color: var(--text-dim);"> / </span>
            <span style="color: var(--danger);">${{ avg_loss_amount|format_float(2) }}</span>
        </h3>
        <small style="color: var(--text-dim);">per bet (units)</small>
    </div>
</div>

<div class="card">
    <h3>Risk Profile</h3>
    <p style="color: var(--text-dim); margin-top: 0.5rem;">Portfolio-style risk assessment for betting performance</p>
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-top: 1.5rem;">
        <div>
            <div style="font-size: 0.85rem; color: var(--text-dim); margin-bottom: 0.5rem;">WIN/LOSS RATIO</div>
            <div style="font-size: 1.8rem; font-weight: 700; font-family: 'JetBrains Mono', monospace;">
                {% if avg_loss_amount != 0 and avg_win_amount and avg_loss_amount %}
                    {{ (avg_win_amount / avg_loss_amount)|format_float(2) }}:1
                {% else %}
                    -
                {% endif %}
            </div>
            <small style="color: var(--text-dim);">
                {% set ratio = (avg_win_amount / avg_loss_amount) if avg_loss_amount != 0 and avg_win_amount and avg_loss_amount else 0 %}
                {% if ratio > 2 %}Excellent{% elif ratio > 1.5 %}Good{% elif ratio > 1 %}Fair{% else %}Poor{% endif %}
            </small>
        </div>

        <div>
            <div style="font-size: 0.85rem; color: var(--text-dim); margin-bottom: 0.5rem;">PROFIT FACTOR</div>
            <div style="font-size: 1.8rem; font-weight: 700; font-family: 'JetBrains Mono', monospace;">
                {% if total_losses != 0 and total_winnings and total_losses %}
                    {{ (total_winnings / total_losses)|format_float(2) }}
                {% else %}
                    -
                {% endif %}
            </div>
            <small style="color: var(--text-dim);">gross wins / gross losses</small>
        </div>

        <div>
            <div style="font-size: 0.85rem; color: var(--text-dim); margin-bottom: 0.5rem;">CONSISTENCY</div>
            <div style="font-size: 1.8rem; font-weight: 700; font-family: 'JetBrains Mono', monospace;">
                {{ ((wins / total_graded * 100) if total_graded > 0 else 0)|format_float(0) }}%
            </div>
            <small style="color: var(--text-dim);">based on win rate stability</small>
        </div>

        <div>
            <div style="font-size: 0.85rem; color: var(--text-dim); margin-bottom: 0.5rem;">RISK LEVEL</div>
            <div style="font-size: 1.8rem; font-weight: 700;">
                {% if max_drawdown and max_drawdown < 50 %}
                    <span style="color: var(--success);">Low</span>
                {% elif max_drawdown and max_drawdown < 150 %}
                    <span style="color: var(--warning);">Moderate</span>
                {% else %}
                    <span style="color: var(--danger);">High</span>
                {% endif %}
            </div>
            <small style="color: var(--text-dim);">based on drawdown</small>
        </div>
    </div>
</div>

<!-- ABOUT SECTION -->
<div class="card" style="margin-top: 2.5rem;">
    <h3>About This Dashboard</h3>
    <p style="margin-bottom: 1rem;">Hedge fund-style analytics tracking betting performance across multiple dimensions.</p>
    <ul style="margin-left: 2rem; line-height: 2;">
        <li><strong>ROI:</strong> Return on investment - total profit as % of total amount wagered</li>
        <li><strong>Max Drawdown:</strong> Largest peak-to-trough decline in bankroll</li>
        <li><strong>Win/Loss Ratio:</strong> Average winning bet amount vs average losing bet amount</li>
        <li><strong>Profit Factor:</strong> Gross profits divided by gross losses (>1 = profitable)</li>
        <li><strong>Z-Score:</strong> Statistical measure of how far the Vegas line deviates from expected value</li>
    </ul>
</div>

<style>
    /* Mobile responsiveness */
    @media (max-width: 768px) {
        /* Stack grids on mobile */
        .stat-grid,
        div[style*="grid-template-columns"] {
            grid-template-columns: 1fr !important;
        }

        /* Make tables scrollable on mobile */
        table {
            display: block;
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
        }

        /* Smaller font sizes on mobile */
        h1 {
            font-size: 1.8rem !important;
        }

        h2 {
            font-size: 1.5rem !important;
        }

        h3 {
            font-size: 1.2rem !important;
        }

        /* Reduce padding in stat boxes */
        .stat-box {
            padding: 1rem !important;
        }

        .stat-box h3 {
            font-size: 1.8rem !important;
        }

        /* Make cards more compact */
        .card {
            padding: 1rem !important;
        }

        /* Stack page header on mobile */
        div[style*="display: flex; align-items: center"] {
            flex-wrap: wrap;
        }

        /* Reduce chart height on mobile */
        #profitChart {
            height: 200px !important;
        }

        div[style*="height: 300px"] {
            height: 200px !important;
        }
    }

    /* Very small screens */
    @media (max-width: 480px) {
        /* Even smaller fonts */
        body {
            font-size: 14px;
        }

        /* Compact stat boxes */
        .stat-box h3 {
            font-size: 1.5rem !important;
        }

        .stat-box p {
            font-size: 0.7rem !important;
        }

        /* Hide some columns in tables on very small screens */
        table th:nth-child(n+5),
        table td:nth-child(n+5) {
            display: none;
        }
    }
</style>

{% endblock %}
