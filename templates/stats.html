{% extends "base.html" %}

{% block title %}Statistics - NBA Props Analyzer{% endblock %}

{% block content %}
<h2>Overall Statistics</h2>

<div class="stat-grid">
    <div class="stat-box">
        <h3>{{ total_plays }}</h3>
        <p>Total Plays</p>
    </div>
    <div class="stat-box">
        <h3>{{ high_confidence }}</h3>
        <p>High Confidence</p>
    </div>
    <div class="stat-box">
        <h3>{{ medium_confidence }}</h3>
        <p>Medium Confidence</p>
    </div>
    <div class="stat-box">
        <h3>{{ days_tracked }}</h3>
        <p>Days Tracked</p>
    </div>
</div>

{% if total_plays > 0 %}
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 1.5rem;">
    <div class="card">
        <h3>By Stat Type</h3>
        <table style="margin-top: 1rem;">
            <thead>
                <tr>
                    <th>Stat</th>
                    <th>Count</th>
                    <th>Percentage</th>
                </tr>
            </thead>
            <tbody>
                {% for stat, count in stat_counts.items()|sort(attribute='1', reverse=True) %}
                <tr>
                    <td>{{ stat }}</td>
                    <td>{{ count }}</td>
                    <td>{{ (count / total_plays * 100)|format_float(1) }}%</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div class="card">
        <h3>By Recommendation</h3>
        <table style="margin-top: 1rem;">
            <thead>
                <tr>
                    <th>Type</th>
                    <th>Count</th>
                    <th>Percentage</th>
                </tr>
            </thead>
            <tbody>
                {% for rec, count in rec_counts.items()|sort(attribute='1', reverse=True) %}
                <tr>
                    <td>
                        {% if rec == 'OVER' %}
                            <span class="badge badge-over">OVER</span>
                        {% elif rec == 'UNDER' %}
                            <span class="badge badge-under">UNDER</span>
                        {% else %}
                            <span class="badge badge-no-play">NO PLAY</span>
                        {% endif %}
                    </td>
                    <td>{{ count }}</td>
                    <td>{{ (count / total_plays * 100)|format_float(1) }}%</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<div class="card">
    <h3>Analysis Metrics</h3>
    <table style="margin-top: 1rem;">
        <tr>
            <th>Metric</th>
            <th>Value</th>
        </tr>
        <tr>
            <td>Average Absolute Z-Score</td>
            <td>{{ avg_z_score|format_float }}</td>
        </tr>
        {% if first_date %}
        <tr>
            <td>First Play Date</td>
            <td>{{ first_date.strftime('%B %d, %Y') }}</td>
        </tr>
        {% endif %}
        {% if last_date %}
        <tr>
            <td>Last Play Date</td>
            <td>{{ last_date.strftime('%B %d, %Y') }}</td>
        </tr>
        {% endif %}
    </table>
</div>

<div class="card">
    <h3>About the Analysis</h3>
    <p style="margin-bottom: 1rem;">This analyzer uses a simple, interpretable statistical approach:</p>
    <ul style="margin-left: 2rem; line-height: 2;">
        <li><strong>Expected Value:</strong> 50% season average + 50% last 5 games average</li>
        <li><strong>Deviation:</strong> How far the Vegas line is from expected value</li>
        <li><strong>Z-Score:</strong> Standardized deviation (accounts for variability)</li>
    </ul>
    <p style="margin-top: 1rem;"><strong>Strategy:</strong> Follow Vegas deviations - when the line differs significantly from expected value, there's likely information we don't have.</p>
</div>
{% else %}
<div class="empty-state">
    <h2>No data yet</h2>
    <p>Start running daily analysis to see statistics here.</p>
</div>
{% endif %}
{% endblock %}
