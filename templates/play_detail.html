{% extends "base.html" %}

{% block title %}{{ play.player_name }} {{ play.stat_type }} - Take Free Points{% endblock %}

{% block content %}
<a href="/" style="color: var(--accent-blue); text-decoration: none; margin-bottom: 1.5rem; display: inline-flex; align-items: center; gap: 0.5rem; font-weight: 500; transition: gap 0.2s ease;">
    <span style="font-size: 1.2rem;">‚Üê</span> Back to Plays
</a>

<!-- Hero Section -->
<div class="card" style="background: linear-gradient(135deg, var(--bg-card) 0%, var(--bg-secondary) 100%); border: 2px solid var(--border); margin-bottom: 1.5rem;">
    <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 1.5rem;">
        <div>
            <h1 style="font-size: clamp(1.8rem, 5vw, 2.5rem); margin-bottom: 0.5rem; color: var(--text-primary);">{{ play.player_name }}</h1>
            <p style="font-size: 1.1rem; color: var(--text-secondary); margin: 0;">{{ play.stat_type|upper }}</p>
        </div>
        <div style="text-align: right;">
            {% if play.recommendation == 'OVER' %}
                <div class="badge badge-over" style="font-size: 1.8rem; padding: 1rem 2rem; margin-bottom: 0.5rem; display: inline-block;">OVER {{ play.line_value|format_float }}</div>
            {% elif play.recommendation == 'UNDER' %}
                <div class="badge badge-under" style="font-size: 1.8rem; padding: 1rem 2rem; margin-bottom: 0.5rem; display: inline-block;">UNDER {{ play.line_value|format_float }}</div>
            {% else %}
                <div class="badge badge-no-play" style="font-size: 1.8rem; padding: 1rem 2rem; margin-bottom: 0.5rem; display: inline-block;">NO PLAY</div>
            {% endif %}
            <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 0.5rem;">
                <span class="badge {% if play.confidence == 'High' %}badge-high{% else %}badge-medium{% endif %}" style="font-size: 0.9rem;">{{ play.confidence }} Confidence</span>
                {% if play.recommendation == 'OVER' %}
                    <span style="color: var(--text-secondary); font-family: 'JetBrains Mono', monospace;">{{ play.over_odds|format_odds }}</span>
                {% elif play.recommendation == 'UNDER' %}
                    <span style="color: var(--text-secondary); font-family: 'JetBrains Mono', monospace;">{{ play.under_odds|format_odds }}</span>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Quick Stats Grid -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1.5rem;">
    <div class="stat-box">
        <p style="color: var(--text-dim); font-size: 0.75rem; text-transform: uppercase; margin-bottom: 0.5rem;">Vegas Line</p>
        <h3 style="font-size: 2rem; margin: 0;">{{ play.line_value|format_float }}</h3>
    </div>

    <div class="stat-box">
        <p style="color: var(--text-dim); font-size: 0.75rem; text-transform: uppercase; margin-bottom: 0.5rem;">Player Average</p>
        <h3 style="font-size: 2rem; margin: 0; color: var(--accent-green);">{{ play.expected_value|format_float }}</h3>
        <small style="color: var(--text-dim);">Season: {{ play.season_avg|format_float }} | L5: {{ play.last5_avg|format_float }}</small>
    </div>

    <div class="stat-box">
        <p style="color: var(--text-dim); font-size: 0.75rem; text-transform: uppercase; margin-bottom: 0.5rem;">Deviation</p>
        <h3 style="font-size: 2rem; margin: 0; color: {% if play.deviation|abs > 2 %}var(--danger){% elif play.deviation|abs > 1 %}var(--warning){% else %}var(--text-secondary){% endif %};">
            {% if play.deviation > 0 %}+{% endif %}{{ play.deviation|format_float }}
        </h3>
        <small style="color: var(--text-dim);">{{ play.z_score|z_to_confidence }} signal</small>
    </div>

    <div class="stat-box">
        <p style="color: var(--text-dim); font-size: 0.75rem; text-transform: uppercase; margin-bottom: 0.5rem;">Sample Size</p>
        <h3 style="font-size: 2rem; margin: 0;">{{ play.games_played or 0 }}</h3>
        <small style="color: var(--text-dim);">games played</small>
    </div>
</div>

<!-- Why This Bet -->
<div class="card">
    <h3 style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 1rem;">
        <span style="font-size: 1.5rem;">üí°</span> Why {{ play.recommendation }}?
    </h3>

    <div style="background: rgba(0, 255, 136, 0.05); border-left: 3px solid var(--accent-green); padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
        {% if play.deviation < 0 %}
            <p style="margin: 0; line-height: 1.7; color: var(--text-primary);">
                <strong>Vegas set the line {{ (play.deviation|abs)|format_float }} points ABOVE</strong> where this player typically performs ({{ play.expected_value|format_float }})
            </p>
            <p style="margin: 0.5rem 0 0 0; color: var(--text-secondary);">
                ‚Üí They expect the player to underperform ‚Üí Bet UNDER
            </p>
        {% elif play.deviation > 0 %}
            <p style="margin: 0; line-height: 1.7; color: var(--text-primary);">
                <strong>Vegas set the line {{ play.deviation|format_float }} points BELOW</strong> where this player typically performs ({{ play.expected_value|format_float }})
            </p>
            <p style="margin: 0.5rem 0 0 0; color: var(--text-secondary);">
                ‚Üí They expect the player to overperform ‚Üí Bet OVER
            </p>
        {% endif %}
    </div>

    <div style="display: grid; gap: 0.75rem; margin-top: 1rem;">
        <div style="display: flex; align-items: start; gap: 0.75rem;">
            <span style="color: var(--accent-green); font-size: 1.2rem; min-width: 24px;">‚úì</span>
            <div>
                <strong style="color: var(--text-primary);">Player averages {{ play.expected_value|format_float }}</strong>
                <p style="margin: 0.25rem 0 0 0; color: var(--text-secondary); font-size: 0.9rem;">
                    Weighted 50/50: Season ({{ play.season_avg|format_float }}) + Last 5 games ({{ play.last5_avg|format_float }})
                </p>
            </div>
        </div>

        <div style="display: flex; align-items: start; gap: 0.75rem;">
            <span style="color: var(--accent-blue); font-size: 1.2rem; min-width: 24px;">‚úì</span>
            <div>
                <strong style="color: var(--text-primary);">Vegas line is {{ play.line_value|format_float }}</strong>
                <p style="margin: 0.25rem 0 0 0; color: var(--text-secondary); font-size: 0.9rem;">
                    {% if play.deviation|abs > 2 %}
                        <span style="color: var(--danger);">Significant</span> {{ (play.deviation|abs)|format_float }}-point gap
                    {% elif play.deviation|abs > 1 %}
                        <span style="color: var(--warning);">Moderate</span> {{ (play.deviation|abs)|format_float }}-point gap
                    {% else %}
                        Small {{ (play.deviation|abs)|format_float }}-point gap
                    {% endif %}
                </p>
            </div>
        </div>

        <div style="display: flex; align-items: start; gap: 0.75rem;">
            <span style="color: var(--accent-purple); font-size: 1.2rem; min-width: 24px;">‚úì</span>
            <div>
                <strong style="color: var(--text-primary);">{{ play.confidence }} confidence signal</strong>
                <p style="margin: 0.25rem 0 0 0; color: var(--text-secondary); font-size: 0.9rem;">
                    Based on {{ play.games_played or 0 }} games, std dev {{ play.std_dev|format_float }}
                </p>
            </div>
        </div>
    </div>
</div>

<!-- Visual Comparison -->
<div class="card">
    <h3 style="margin-bottom: 1rem;">Visual Breakdown</h3>

    <div style="margin-bottom: 2rem;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
            <span style="color: var(--text-secondary); font-size: 0.85rem;">Season Average</span>
            <span style="font-family: 'JetBrains Mono', monospace; color: var(--text-primary); font-weight: 600;">{{ play.season_avg|format_float }}</span>
        </div>
        <div style="background: var(--bg-secondary); height: 8px; border-radius: 4px; overflow: hidden;">
            <div style="background: linear-gradient(90deg, var(--accent-green), var(--accent-blue)); height: 100%; width: {% if play.line_value > 0 %}{{ (play.season_avg / play.line_value * 100)|int }}%{% else %}0%{% endif %}; border-radius: 4px;"></div>
        </div>
    </div>

    <div style="margin-bottom: 2rem;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
            <span style="color: var(--text-secondary); font-size: 0.85rem;">Last 5 Games Average</span>
            <span style="font-family: 'JetBrains Mono', monospace; color: var(--text-primary); font-weight: 600;">{{ play.last5_avg|format_float }}</span>
        </div>
        <div style="background: var(--bg-secondary); height: 8px; border-radius: 4px; overflow: hidden;">
            <div style="background: linear-gradient(90deg, var(--accent-purple), var(--accent-blue)); height: 100%; width: {% if play.line_value > 0 %}{{ (play.last5_avg / play.line_value * 100)|int }}%{% else %}0%{% endif %}; border-radius: 4px;"></div>
        </div>
    </div>

    <div style="margin-bottom: 0;">
        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
            <span style="color: var(--text-secondary); font-size: 0.85rem; font-weight: 600;">Vegas Line</span>
            <span style="font-family: 'JetBrains Mono', monospace; color: var(--accent-green); font-weight: 700; font-size: 1.1rem;">{{ play.line_value|format_float }}</span>
        </div>
        <div style="background: var(--bg-secondary); height: 12px; border-radius: 6px; overflow: hidden; border: 2px solid var(--accent-green);">
            <div style="background: var(--accent-green); height: 100%; width: 100%; border-radius: 4px;"></div>
        </div>
    </div>
</div>

<!-- Metadata -->
<div class="card" style="background: var(--bg-secondary); border: 1px solid var(--border);">
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1rem; font-size: 0.9rem;">
        <div>
            <span style="color: var(--text-dim);">Bookmaker</span>
            <p style="margin: 0.25rem 0 0 0; color: var(--text-primary); font-weight: 600;">{{ play.bookmaker or 'N/A' }}</p>
        </div>
        {% if game %}
        <div>
            <span style="color: var(--text-dim);">Game Time</span>
            <p style="margin: 0.25rem 0 0 0; color: var(--text-primary); font-weight: 600;">{{ (game.game_date|to_local).strftime('%b %d, %I:%M %p') }}</p>
        </div>
        {% endif %}
        <div>
            <span style="color: var(--text-dim);">Analysis Created</span>
            <p style="margin: 0.25rem 0 0 0; color: var(--text-primary); font-weight: 600;">{{ (play.created_at|to_local).strftime('%b %d, %I:%M %p') }}</p>
        </div>
    </div>
</div>

{% endblock %}
