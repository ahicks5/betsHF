{% extends "base.html" %}

{% block title %}{{ play.player_name }} {{ play.stat_type }} - PropEdge{% endblock %}

{% block content %}
<a href="/" style="color: #3498db; text-decoration: none; margin-bottom: 1rem; display: inline-block;">&larr; Back to Today's Plays</a>

<div class="card">
    <h2>{{ play.player_name }} - {{ play.stat_type }}</h2>

    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem; margin-top: 1.5rem;">
        <div>
            <h3 style="color: #7f8c8d; font-size: 0.9rem; margin-bottom: 0.5rem;">RECOMMENDATION</h3>
            <p style="font-size: 1.5rem; font-weight: bold;">
                {% if play.recommendation == 'OVER' %}
                    <span class="badge badge-over" style="font-size: 1.2rem; padding: 0.5rem 1rem;">OVER {{ play.line_value|format_float }}</span>
                {% elif play.recommendation == 'UNDER' %}
                    <span class="badge badge-under" style="font-size: 1.2rem; padding: 0.5rem 1rem;">UNDER {{ play.line_value|format_float }}</span>
                {% else %}
                    <span class="badge badge-no-play" style="font-size: 1.2rem; padding: 0.5rem 1rem;">NO PLAY</span>
                {% endif %}
            </p>
        </div>

        <div>
            <h3 style="color: #7f8c8d; font-size: 0.9rem; margin-bottom: 0.5rem;">CONFIDENCE</h3>
            <p style="font-size: 1.5rem; font-weight: bold;">
                {% if play.confidence == 'High' %}
                    <span class="badge badge-high" style="font-size: 1.2rem; padding: 0.5rem 1rem;">High</span>
                {% elif play.confidence == 'Medium' %}
                    <span class="badge badge-medium" style="font-size: 1.2rem; padding: 0.5rem 1rem;">Medium</span>
                {% else %}
                    {{ play.confidence or 'N/A' }}
                {% endif %}
            </p>
        </div>

        <div>
            <h3 style="color: #7f8c8d; font-size: 0.9rem; margin-bottom: 0.5rem;">ODDS</h3>
            <p style="font-size: 1.5rem; font-weight: bold;">
                {% if play.recommendation == 'OVER' %}
                    {{ play.over_odds|format_odds }}
                {% elif play.recommendation == 'UNDER' %}
                    {{ play.under_odds|format_odds }}
                {% else %}
                    -
                {% endif %}
            </p>
        </div>

        <div>
            <h3 style="color: #7f8c8d; font-size: 0.9rem; margin-bottom: 0.5rem;">BOOKMAKER</h3>
            <p style="font-size: 1.5rem; font-weight: bold;">{{ play.bookmaker or 'N/A' }}</p>
        </div>
    </div>
</div>

<div class="card">
    <h3>Analysis Details</h3>

    <table style="margin-top: 1rem;">
        <tr>
            <th>Metric</th>
            <th>Value</th>
        </tr>
        <tr>
            <td>Vegas Line</td>
            <td><strong>{{ play.line_value|format_float }}</strong></td>
        </tr>
        <tr>
            <td>Player Season Average</td>
            <td>{{ play.season_avg|format_float }}</td>
        </tr>
        <tr>
            <td>Player Last 5 Games Avg</td>
            <td>{{ play.last5_avg|format_float }}</td>
        </tr>
        <tr>
            <td><strong>Player Historical Avg</strong></td>
            <td><strong>{{ play.expected_value|format_float }}</strong></td>
        </tr>
        <tr>
            <td>Player Consistency (Std Dev)</td>
            <td>{{ play.std_dev|format_float }}</td>
        </tr>
        <tr>
            <td><strong>Vegas Deviation</strong></td>
            <td><strong>{{ play.deviation|format_float }}</strong></td>
        </tr>
        <tr>
            <td><strong>Signal Strength</strong></td>
            <td><strong>{{ play.z_score|z_to_confidence }}</strong> (z-score: {{ play.z_score|format_float }})</td>
        </tr>
    </table>

    <div style="margin-top: 1.5rem; padding: 1rem; background: #ecf0f1; border-radius: 4px;">
        <h4>How It Works</h4>
        <p style="margin-top: 0.5rem; font-family: monospace;">
            Player Avg = (Season {{ play.season_avg|format_float }} √ó 50%) + (Last 5 {{ play.last5_avg|format_float }} √ó 50%) = {{ play.expected_value|format_float }}
        </p>
        <p style="margin-top: 0.5rem; font-family: monospace;">
            Vegas Deviation = Vegas Line {{ play.line_value|format_float }} - Player Avg {{ play.expected_value|format_float }} = {{ play.deviation|format_float }}
        </p>
        <p style="margin-top: 0.5rem; font-family: monospace;">
            Signal Strength = {{ play.z_score|z_to_confidence }} (based on player consistency)
        </p>
    </div>
</div>

<div class="card">
    <h3>What This Means</h3>
    <div style="margin-top: 1rem;">
        <p><strong>Signal Strength: {{ play.z_score|z_to_confidence }}</strong></p>

        {% if play.z_score|abs >= 1.5 %}
            <p style="margin-top: 0.5rem;">üî• <strong>Very Strong Signal</strong> - Vegas line is unusually different from what this player typically does. When Vegas moves the line this much, they usually know something.</p>
        {% elif play.z_score|abs >= 1.0 %}
            <p style="margin-top: 0.5rem;">üí™ <strong>Strong Signal</strong> - Vegas line shows significant deviation from player averages. Worth consideration.</p>
        {% elif play.z_score|abs >= 0.5 %}
            <p style="margin-top: 0.5rem;">‚ö° <strong>Medium Signal</strong> - Vegas line shows moderate deviation. Proceed with caution.</p>
        {% else %}
            <p style="margin-top: 0.5rem;">üòê <strong>Weak Signal</strong> - Vegas line is close to player averages. Not a strong play.</p>
        {% endif %}

        <p style="margin-top: 1rem;"><strong>The Strategy:</strong></p>
        {% if play.deviation < 0 %}
            <p style="margin-top: 0.5rem;">Vegas set the line at <strong>{{ play.line_value|format_float }}</strong>, which is <strong>higher</strong> than the player's typical performance of {{ play.expected_value|format_float }}. When Vegas moves a line UP like this, they're expecting the player to do WORSE than usual. We follow Vegas and bet <strong>UNDER</strong>.</p>
        {% elif play.deviation > 0 %}
            <p style="margin-top: 0.5rem;">Vegas set the line at <strong>{{ play.line_value|format_float }}</strong>, which is <strong>lower</strong> than the player's typical performance of {{ play.expected_value|format_float }}. When Vegas moves a line DOWN like this, they're expecting the player to do BETTER than usual. We follow Vegas and bet <strong>OVER</strong>.</p>
        {% endif %}
    </div>
</div>

<div class="card">
    <h3>Timestamps</h3>
    <table style="margin-top: 1rem;">
        <tr>
            <td>Analysis Created</td>
            <td>{{ (play.created_at|to_local).strftime('%b %d, %Y at %I:%M %p %Z') }}</td>
        </tr>
        {% if prop_line %}
        <tr>
            <td>Line Collected</td>
            <td>{{ (prop_line.collected_at|to_local).strftime('%b %d, %Y at %I:%M %p %Z') }}</td>
        </tr>
        {% endif %}
        {% if game %}
        <tr>
            <td>Game Scheduled</td>
            <td>{{ (game.game_date|to_local).strftime('%b %d, %Y at %I:%M %p %Z') }}</td>
        </tr>
        {% endif %}
    </table>
</div>
{% endblock %}
